{"ast":null,"code":"import { AZURE_FUNCTIONS } from '../config/config';\n\n// Optional function key (if your function requires it)\n// Put in frontend/.env : REACT_APP_AZURE_FUNC_KEY=xxxxx\nconst FUNCTION_KEY = process.env.REACT_APP_AZURE_FUNC_KEY;\nfunction buildUrl() {\n  const base = AZURE_FUNCTIONS.WELCOME_EMAIL;\n  if (FUNCTION_KEY) {\n    return base.includes('?') ? `${base}&code=${FUNCTION_KEY}` : `${base}?code=${FUNCTION_KEY}`;\n  }\n  return base;\n}\n\n/**\r\n * Try sending email. First attempt normal fetch.\r\n * If it fails due to CORS/network, fallback to no-cors (opaque response).\r\n */\nexport async function sendWelcomeEmail(email, name) {\n  const payload = {\n    email,\n    name\n  };\n  const url = buildUrl();\n\n  // Attempt 1: normal fetch\n  try {\n    const resp = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(FUNCTION_KEY ? {\n          'x-functions-key': FUNCTION_KEY\n        } : {})\n      },\n      body: JSON.stringify(payload)\n    });\n    const text = await resp.text().catch(() => '');\n    if (!resp.ok) {\n      console.warn('Azure Function non-OK:', resp.status, text);\n      return {\n        ok: false,\n        status: resp.status,\n        body: text\n      };\n    }\n    return {\n      ok: true,\n      status: resp.status,\n      body: text\n    };\n  } catch (err) {\n    console.warn('Erreur envoi email (normal fetch):', err);\n  }\n\n  // Attempt 2: fallback no-cors (will be opaque; best-effort)\n  try {\n    const resp2 = await fetch(url, {\n      method: 'POST',\n      mode: 'no-cors',\n      headers: {\n        'Content-Type': 'application/json',\n        ...(FUNCTION_KEY ? {\n          'x-functions-key': FUNCTION_KEY\n        } : {})\n      },\n      body: JSON.stringify(payload)\n    });\n    // Opaque response; assume success best-effort\n    console.debug('no-cors fallback used for email');\n    return {\n      ok: true,\n      opaque: true\n    };\n  } catch (err2) {\n    console.warn('Erreur envoi email (no-cors fallback):', err2);\n    return {\n      ok: false,\n      error: (err2 === null || err2 === void 0 ? void 0 : err2.message) || String(err2)\n    };\n  }\n}\nexport default {\n  sendWelcomeEmail\n};","map":{"version":3,"names":["AZURE_FUNCTIONS","FUNCTION_KEY","process","env","REACT_APP_AZURE_FUNC_KEY","buildUrl","base","WELCOME_EMAIL","includes","sendWelcomeEmail","email","name","payload","url","resp","fetch","method","headers","body","JSON","stringify","text","catch","ok","console","warn","status","err","resp2","mode","debug","opaque","err2","error","message","String"],"sources":["C:/Users/Hp/Desktop/Cloud_Project/frontend/src/services/emailService.js"],"sourcesContent":["import { AZURE_FUNCTIONS } from '../config/config';\r\n\r\n// Optional function key (if your function requires it)\r\n// Put in frontend/.env : REACT_APP_AZURE_FUNC_KEY=xxxxx\r\nconst FUNCTION_KEY = process.env.REACT_APP_AZURE_FUNC_KEY;\r\n\r\nfunction buildUrl() {\r\n  const base = AZURE_FUNCTIONS.WELCOME_EMAIL;\r\n  if (FUNCTION_KEY) {\r\n    return base.includes('?') ? `${base}&code=${FUNCTION_KEY}` : `${base}?code=${FUNCTION_KEY}`;\r\n  }\r\n  return base;\r\n}\r\n\r\n/**\r\n * Try sending email. First attempt normal fetch.\r\n * If it fails due to CORS/network, fallback to no-cors (opaque response).\r\n */\r\nexport async function sendWelcomeEmail(email, name) {\r\n  const payload = { email, name };\r\n  const url = buildUrl();\r\n\r\n  // Attempt 1: normal fetch\r\n  try {\r\n    const resp = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(FUNCTION_KEY ? { 'x-functions-key': FUNCTION_KEY } : {}),\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n    const text = await resp.text().catch(() => '');\r\n    if (!resp.ok) {\r\n      console.warn('Azure Function non-OK:', resp.status, text);\r\n      return { ok: false, status: resp.status, body: text };\r\n    }\r\n    return { ok: true, status: resp.status, body: text };\r\n  } catch (err) {\r\n    console.warn('Erreur envoi email (normal fetch):', err);\r\n  }\r\n\r\n  // Attempt 2: fallback no-cors (will be opaque; best-effort)\r\n  try {\r\n    const resp2 = await fetch(url, {\r\n      method: 'POST',\r\n      mode: 'no-cors',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(FUNCTION_KEY ? { 'x-functions-key': FUNCTION_KEY } : {}),\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n    // Opaque response; assume success best-effort\r\n    console.debug('no-cors fallback used for email');\r\n    return { ok: true, opaque: true };\r\n  } catch (err2) {\r\n    console.warn('Erreur envoi email (no-cors fallback):', err2);\r\n    return { ok: false, error: err2?.message || String(err2) };\r\n  }\r\n}\r\n\r\nexport default { sendWelcomeEmail };\r\n"],"mappings":"AAAA,SAASA,eAAe,QAAQ,kBAAkB;;AAElD;AACA;AACA,MAAMC,YAAY,GAAGC,OAAO,CAACC,GAAG,CAACC,wBAAwB;AAEzD,SAASC,QAAQA,CAAA,EAAG;EAClB,MAAMC,IAAI,GAAGN,eAAe,CAACO,aAAa;EAC1C,IAAIN,YAAY,EAAE;IAChB,OAAOK,IAAI,CAACE,QAAQ,CAAC,GAAG,CAAC,GAAG,GAAGF,IAAI,SAASL,YAAY,EAAE,GAAG,GAAGK,IAAI,SAASL,YAAY,EAAE;EAC7F;EACA,OAAOK,IAAI;AACb;;AAEA;AACA;AACA;AACA;AACA,OAAO,eAAeG,gBAAgBA,CAACC,KAAK,EAAEC,IAAI,EAAE;EAClD,MAAMC,OAAO,GAAG;IAAEF,KAAK;IAAEC;EAAK,CAAC;EAC/B,MAAME,GAAG,GAAGR,QAAQ,CAAC,CAAC;;EAEtB;EACA,IAAI;IACF,MAAMS,IAAI,GAAG,MAAMC,KAAK,CAACF,GAAG,EAAE;MAC5BG,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,IAAIhB,YAAY,GAAG;UAAE,iBAAiB,EAAEA;QAAa,CAAC,GAAG,CAAC,CAAC;MAC7D,CAAC;MACDiB,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACR,OAAO;IAC9B,CAAC,CAAC;IACF,MAAMS,IAAI,GAAG,MAAMP,IAAI,CAACO,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,MAAM,EAAE,CAAC;IAC9C,IAAI,CAACR,IAAI,CAACS,EAAE,EAAE;MACZC,OAAO,CAACC,IAAI,CAAC,wBAAwB,EAAEX,IAAI,CAACY,MAAM,EAAEL,IAAI,CAAC;MACzD,OAAO;QAAEE,EAAE,EAAE,KAAK;QAAEG,MAAM,EAAEZ,IAAI,CAACY,MAAM;QAAER,IAAI,EAAEG;MAAK,CAAC;IACvD;IACA,OAAO;MAAEE,EAAE,EAAE,IAAI;MAAEG,MAAM,EAAEZ,IAAI,CAACY,MAAM;MAAER,IAAI,EAAEG;IAAK,CAAC;EACtD,CAAC,CAAC,OAAOM,GAAG,EAAE;IACZH,OAAO,CAACC,IAAI,CAAC,oCAAoC,EAAEE,GAAG,CAAC;EACzD;;EAEA;EACA,IAAI;IACF,MAAMC,KAAK,GAAG,MAAMb,KAAK,CAACF,GAAG,EAAE;MAC7BG,MAAM,EAAE,MAAM;MACda,IAAI,EAAE,SAAS;MACfZ,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,IAAIhB,YAAY,GAAG;UAAE,iBAAiB,EAAEA;QAAa,CAAC,GAAG,CAAC,CAAC;MAC7D,CAAC;MACDiB,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACR,OAAO;IAC9B,CAAC,CAAC;IACF;IACAY,OAAO,CAACM,KAAK,CAAC,iCAAiC,CAAC;IAChD,OAAO;MAAEP,EAAE,EAAE,IAAI;MAAEQ,MAAM,EAAE;IAAK,CAAC;EACnC,CAAC,CAAC,OAAOC,IAAI,EAAE;IACbR,OAAO,CAACC,IAAI,CAAC,wCAAwC,EAAEO,IAAI,CAAC;IAC5D,OAAO;MAAET,EAAE,EAAE,KAAK;MAAEU,KAAK,EAAE,CAAAD,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEE,OAAO,KAAIC,MAAM,CAACH,IAAI;IAAE,CAAC;EAC5D;AACF;AAEA,eAAe;EAAEvB;AAAiB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}