{"ast":null,"code":"import _objectSpread from\"C:/Users/Hp/Desktop/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{AZURE_FUNCTIONS}from'../config/config';// Optional function key (if your function requires it)\n// Put in frontend/.env : REACT_APP_AZURE_FUNC_KEY=xxxxx\nconst FUNCTION_KEY=process.env.REACT_APP_AZURE_FUNC_KEY;function buildUrl(){const base=AZURE_FUNCTIONS.WELCOME_EMAIL;if(FUNCTION_KEY){return base.includes('?')?\"\".concat(base,\"&code=\").concat(FUNCTION_KEY):\"\".concat(base,\"?code=\").concat(FUNCTION_KEY);}return base;}/**\r\n * Try sending email. First attempt normal fetch.\r\n * If it fails due to CORS/network, fallback to no-cors (opaque response).\r\n */export async function sendWelcomeEmail(email,name){const payload={email,name};const url=buildUrl();// Attempt 1: normal fetch\ntry{const resp=await fetch(url,{method:'POST',headers:_objectSpread({'Content-Type':'application/json'},FUNCTION_KEY?{'x-functions-key':FUNCTION_KEY}:{}),body:JSON.stringify(payload)});const text=await resp.text().catch(()=>'');if(!resp.ok){console.warn('Azure Function non-OK:',resp.status,text);return{ok:false,status:resp.status,body:text};}return{ok:true,status:resp.status,body:text};}catch(err){console.warn('Erreur envoi email (normal fetch):',err);}// Attempt 2: fallback no-cors (will be opaque; best-effort)\ntry{const resp2=await fetch(url,{method:'POST',mode:'no-cors',headers:_objectSpread({'Content-Type':'application/json'},FUNCTION_KEY?{'x-functions-key':FUNCTION_KEY}:{}),body:JSON.stringify(payload)});// Opaque response; assume success best-effort\nconsole.debug('no-cors fallback used for email');return{ok:true,opaque:true};}catch(err2){console.warn('Erreur envoi email (no-cors fallback):',err2);return{ok:false,error:(err2===null||err2===void 0?void 0:err2.message)||String(err2)};}}export default{sendWelcomeEmail};","map":{"version":3,"names":["AZURE_FUNCTIONS","FUNCTION_KEY","process","env","REACT_APP_AZURE_FUNC_KEY","buildUrl","base","WELCOME_EMAIL","includes","concat","sendWelcomeEmail","email","name","payload","url","resp","fetch","method","headers","_objectSpread","body","JSON","stringify","text","catch","ok","console","warn","status","err","resp2","mode","debug","opaque","err2","error","message","String"],"sources":["C:/Users/Hp/Desktop/frontend/src/services/emailService.js"],"sourcesContent":["import { AZURE_FUNCTIONS } from '../config/config';\r\n\r\n// Optional function key (if your function requires it)\r\n// Put in frontend/.env : REACT_APP_AZURE_FUNC_KEY=xxxxx\r\nconst FUNCTION_KEY = process.env.REACT_APP_AZURE_FUNC_KEY;\r\n\r\nfunction buildUrl() {\r\n  const base = AZURE_FUNCTIONS.WELCOME_EMAIL;\r\n  if (FUNCTION_KEY) {\r\n    return base.includes('?') ? `${base}&code=${FUNCTION_KEY}` : `${base}?code=${FUNCTION_KEY}`;\r\n  }\r\n  return base;\r\n}\r\n\r\n/**\r\n * Try sending email. First attempt normal fetch.\r\n * If it fails due to CORS/network, fallback to no-cors (opaque response).\r\n */\r\nexport async function sendWelcomeEmail(email, name) {\r\n  const payload = { email, name };\r\n  const url = buildUrl();\r\n\r\n  // Attempt 1: normal fetch\r\n  try {\r\n    const resp = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(FUNCTION_KEY ? { 'x-functions-key': FUNCTION_KEY } : {}),\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n    const text = await resp.text().catch(() => '');\r\n    if (!resp.ok) {\r\n      console.warn('Azure Function non-OK:', resp.status, text);\r\n      return { ok: false, status: resp.status, body: text };\r\n    }\r\n    return { ok: true, status: resp.status, body: text };\r\n  } catch (err) {\r\n    console.warn('Erreur envoi email (normal fetch):', err);\r\n  }\r\n\r\n  // Attempt 2: fallback no-cors (will be opaque; best-effort)\r\n  try {\r\n    const resp2 = await fetch(url, {\r\n      method: 'POST',\r\n      mode: 'no-cors',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        ...(FUNCTION_KEY ? { 'x-functions-key': FUNCTION_KEY } : {}),\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n    // Opaque response; assume success best-effort\r\n    console.debug('no-cors fallback used for email');\r\n    return { ok: true, opaque: true };\r\n  } catch (err2) {\r\n    console.warn('Erreur envoi email (no-cors fallback):', err2);\r\n    return { ok: false, error: err2?.message || String(err2) };\r\n  }\r\n}\r\n\r\nexport default { sendWelcomeEmail };\r\n"],"mappings":"iHAAA,OAASA,eAAe,KAAQ,kBAAkB,CAElD;AACA;AACA,KAAM,CAAAC,YAAY,CAAGC,OAAO,CAACC,GAAG,CAACC,wBAAwB,CAEzD,QAAS,CAAAC,QAAQA,CAAA,CAAG,CAClB,KAAM,CAAAC,IAAI,CAAGN,eAAe,CAACO,aAAa,CAC1C,GAAIN,YAAY,CAAE,CAChB,MAAO,CAAAK,IAAI,CAACE,QAAQ,CAAC,GAAG,CAAC,IAAAC,MAAA,CAAMH,IAAI,WAAAG,MAAA,CAASR,YAAY,KAAAQ,MAAA,CAAQH,IAAI,WAAAG,MAAA,CAASR,YAAY,CAAE,CAC7F,CACA,MAAO,CAAAK,IAAI,CACb,CAEA;AACA;AACA;AACA,GACA,MAAO,eAAe,CAAAI,gBAAgBA,CAACC,KAAK,CAAEC,IAAI,CAAE,CAClD,KAAM,CAAAC,OAAO,CAAG,CAAEF,KAAK,CAAEC,IAAK,CAAC,CAC/B,KAAM,CAAAE,GAAG,CAAGT,QAAQ,CAAC,CAAC,CAEtB;AACA,GAAI,CACF,KAAM,CAAAU,IAAI,CAAG,KAAM,CAAAC,KAAK,CAACF,GAAG,CAAE,CAC5BG,MAAM,CAAE,MAAM,CACdC,OAAO,CAAAC,aAAA,EACL,cAAc,CAAE,kBAAkB,EAC9BlB,YAAY,CAAG,CAAE,iBAAiB,CAAEA,YAAa,CAAC,CAAG,CAAC,CAAC,CAC5D,CACDmB,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACT,OAAO,CAC9B,CAAC,CAAC,CACF,KAAM,CAAAU,IAAI,CAAG,KAAM,CAAAR,IAAI,CAACQ,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,IAAM,EAAE,CAAC,CAC9C,GAAI,CAACT,IAAI,CAACU,EAAE,CAAE,CACZC,OAAO,CAACC,IAAI,CAAC,wBAAwB,CAAEZ,IAAI,CAACa,MAAM,CAAEL,IAAI,CAAC,CACzD,MAAO,CAAEE,EAAE,CAAE,KAAK,CAAEG,MAAM,CAAEb,IAAI,CAACa,MAAM,CAAER,IAAI,CAAEG,IAAK,CAAC,CACvD,CACA,MAAO,CAAEE,EAAE,CAAE,IAAI,CAAEG,MAAM,CAAEb,IAAI,CAACa,MAAM,CAAER,IAAI,CAAEG,IAAK,CAAC,CACtD,CAAE,MAAOM,GAAG,CAAE,CACZH,OAAO,CAACC,IAAI,CAAC,oCAAoC,CAAEE,GAAG,CAAC,CACzD,CAEA;AACA,GAAI,CACF,KAAM,CAAAC,KAAK,CAAG,KAAM,CAAAd,KAAK,CAACF,GAAG,CAAE,CAC7BG,MAAM,CAAE,MAAM,CACdc,IAAI,CAAE,SAAS,CACfb,OAAO,CAAAC,aAAA,EACL,cAAc,CAAE,kBAAkB,EAC9BlB,YAAY,CAAG,CAAE,iBAAiB,CAAEA,YAAa,CAAC,CAAG,CAAC,CAAC,CAC5D,CACDmB,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACT,OAAO,CAC9B,CAAC,CAAC,CACF;AACAa,OAAO,CAACM,KAAK,CAAC,iCAAiC,CAAC,CAChD,MAAO,CAAEP,EAAE,CAAE,IAAI,CAAEQ,MAAM,CAAE,IAAK,CAAC,CACnC,CAAE,MAAOC,IAAI,CAAE,CACbR,OAAO,CAACC,IAAI,CAAC,wCAAwC,CAAEO,IAAI,CAAC,CAC5D,MAAO,CAAET,EAAE,CAAE,KAAK,CAAEU,KAAK,CAAE,CAAAD,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,GAAIC,MAAM,CAACH,IAAI,CAAE,CAAC,CAC5D,CACF,CAEA,cAAe,CAAExB,gBAAiB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}